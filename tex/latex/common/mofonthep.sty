\ProvidesPackage{mofonthep}
%%%% New set costum fonts

%set the fonts
%the order must be amsmath>hepparticles>unicode-math>fontspec
\RequirePackage{amsmath,amssymb,amstext,amsthm,bm}
\RequirePackage[italic
	]{hepparticles}

\RequirePackage{heppennames}

\RequirePackage{mathtools}
\RequirePackage[
	% mathrm=sym,mathit=sym,mathsf=sym,mathbf=sym,mathtt=sym,
	math-style=ISO,
	bold-style=ISO,
	nabla=upright
]{unicode-math}

\RequirePackage{fontspec}

% Add Emojis via fallback fonts
\directlua{luaotfload.add_fallback(
	"fallbacks",
	{
		% "Libertinus Math Regular:style=Regular;",
		% "Noto Color Emoji:style=Regular;",
		% "FiraCode Nerd Font:style=Regular;",
		"NotoColorEmoji.ttf:mode=harf;",
		% "Fura Code Regular Nerd Font Complete:style=Regular;",
		% "Symbola:style=Regular;"
		% "Noto Serif CJK SC:style=Regular;"
	})
}

\defaultfontfeatures{RawFeature={fallback=fallbacks}}

\setmathfont{Libertinus Math}
\setmathrm{Libertinus Math}

\setsansfont{Libertinus Sans}
\setmainfont{Libertinus Serif}

% %%%%% Fix hepparticles #1
% %%%%% https://tex.stackexchange.com/questions/616301/no-output-by-hepparticles
% \RequirePackage{xpatch}
% \makeatletter
% \xpatchcmd\@HepConStyle
%  {\edef\@upcode{\updefault}}
%  {\ifdefined\shapedefault\edef\@upcode{\shapedefault}\else\edef\@upcode{\updefault}\fi}
%  {}{}
% \makeatother
% %%%%% Fix hepparticles #2
% %%%%% https://tex.stackexchange.com/questions/384400/missing-uppercase-greek-symbols-in-lualatex-memoir-titles
% \SetMathAlphabet{\mathup}{bold}{OT1}{\familydefault}{bx}{n}
% % \SetMathAlphabet{\mathup}{bold}{OT1}{\familydefault}{b}{n}
% % \SetMathAlphabet{\mathup}{bold}{TU}{\familydefault}{bx}{n}
% % \SetMathAlphabet{\mathup}{bold}{\UnicodeEncodingName}{\familydefault}{b}{n}
% % %%%%%
% % % %%%%% heading math bold
% % % %%%%% https://tex.stackexchange.com/questions/41379/automatically-typeset-math-in-section-headings-in-bold-face
% % % \makeatletter
% % % \g@addto@macro\bfseries{\boldmath}
% % % \makeatother
% % % %%%%%


% Use Sans font for beamer
\DeclareOption{beamer}{%
	\setmainfont{Libertinus Sans}
}

\ProcessOptions\relax

\RequirePackage{polyglossia}
\setdefaultlanguage{english}

%xspace command for automatic spacing of shortcuts
\RequirePackage{xspace}
\xspaceaddexceptions{''}
\xspaceaddexceptions{“}
\xspaceaddexceptions{«}